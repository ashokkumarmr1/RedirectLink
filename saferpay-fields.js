/*! Saferpay Fields Library v1.0.0 | Copyright (c) 2019 SIX Payment Services AG. All rights reserved. */
var SaferpayFields=function(){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var I=function(){function d(){n(this,d)}return t(d,null,[{key:"isFunction",value:function(e){return!!(e&&e.constructor&&e.call&&e.apply)}},{key:"buildApiUrl",value:function(e){var t=e.split("/"),n=t.slice(0,t.length-1).join("/");n=n+"/Api/"+t[t.length-1];for(var r=1;r<arguments.length;r++)"/"!==n[n.length-1]&&(n+="/"),n+=arguments[r];return n}},{key:"buildUIUrl",value:function(e){var t=e.split("/"),n=t.slice(0,t.length-1).join("/");n=n+"/UI/"+t[t.length-1];for(var r=1;r<arguments.length;r++)"/"!==n[n.length-1]&&(n+="/"),n+=arguments[r];return n}},{key:"postJson",value:function(e){var t=e.url,n=e.data,r=e.headers,i=void 0===r?null:r,a=e.success,o=void 0===a?null:a,l=e.error,s=void 0===l?null:l,u=new XMLHttpRequest;if(u.onreadystatechange=function(){if(u.readyState===XMLHttpRequest.DONE)if(200<=u.status&&u.status<300){if(!d.isFunction(o))return;o(JSON.parse(u.responseText))}else d.isFunction(s)&&(0===u.responseText.indexOf("{")?s(JSON.parse(u.responseText)):s({message:u.responseText,statusCode:u.status}))},u.open("POST",t),u.setRequestHeader("Content-Type","application/json; charset=utf-8"),i)for(var c in i)i.hasOwnProperty(c)&&u.setRequestHeader(c,i[c]);u.send(JSON.stringify(n))}}]),d}(),a=[],o=new Map,U=function(){function i(){n(this,i)}return t(i,null,[{key:"onMessage",value:function(t){switch(t.data.event){case"submit":case"ready":a[t.data.event].forEach(function(e){return e.call(i,t.data)});break;case"blur":case"focus":a[t.data.event].forEach(function(e){return e.call(i,{event:t.data.event,id:t.target.frameId,fieldType:t.data.fieldType})});break;case"validated":a[t.data.event].forEach(function(e){return e.call(i,{event:t.data.event,id:t.target.frameId,fieldType:t.data.fieldType,isValid:t.data.isValid})})}}},{key:"init",value:function(e){this._baseUrl=e,window.addEventListener?window.addEventListener("message",i.onMessage,!1):window.attachEvent("message",i.onMessage)}},{key:"registerEvent",value:function(e,t){I.isFunction(t)&&(a[e]||(a[e]=[]),a[e].push(t))}},{key:"configureFrame",value:function(e,t){var n=new MessageChannel;if(n.port1.onmessage=i.onMessage,n.port1.frameId=e.id,o.set(e.id,n),e){var r={action:"configure"};t&&(r.options={placeholders:t.placeholders,style:t.style,cssUrl:t.cssUrl}),e.contentWindow.postMessage(r,i._baseUrl,[n.port2])}}},{key:"submitData",value:function(){var e=o.get("fields-controller");e&&e.port1.postMessage({action:"submit"})}},{key:"applyStyling",value:function(e,t){o.get(e.id).port1.postMessage({action:"style",data:t})}}]),i}(),S=function(){function e(){n(this,e)}return t(e,null,[{key:"appendControllerIframe",value:function(e,t){var n=I.buildUIUrl(e,t,"Field","controller"),r=document.createElement("iframe"),i="fields-controller";return r.setAttribute("id",i),r.setAttribute("name",i),r.setAttribute("frameborder","0"),r.setAttribute("scrolling","no"),r.setAttribute("style","display:none;"),r.setAttribute("sandbox","allow-scripts allow-same-origin"),r.setAttribute("src",n),r.onload=function(){U.configureFrame(r)},document.body.appendChild(r),r}},{key:"ensurePlaceholderFieldsAreSupported",value:function(e){var i=["DIV","SPAN"],a=[];if(e.forEach(function(e){var t=document.getElementById(e);if(t){var n=0<=i.indexOf(t.tagName),r="text"===t.type&&t.readOnly;n||r||(t.setAttribute("readonly","readonly"),a.push(e))}}),0<a.length)throw"Unsupported placeholder element for field(s) '".concat(a.join(", "),"'. Only ").concat(i.join(", ")," or readonly input fields are supported!")}},{key:"ensurePlaceholderFieldsExist",value:function(e){var t=e.filter(function(e){return!document.getElementById(e)});if(0<t.length){var n="Missing placeholder element(s) '".concat(t.join(", "),"'.");if("interactive"!==document.readyState&&"complete"!==document.readyState)throw n+" DOM not ready, please call SaferpayFields.Init() after elements are loaded.";throw n}}},{key:"replaceElementWithHostedFieldsIframe",value:function(e,t,n,r,i){var a=I.buildUIUrl(t,n,"Field",r),o=document.createElement("iframe"),l=document.getElementById(e);if(l){var s=l.offsetWidth,u=l.offsetHeight;return o.setAttribute("id",e),o.setAttribute("name",e),o.setAttribute("frameborder","0"),o.setAttribute("scrolling","no"),o.setAttribute("style","overflow:visible;width:"+s+"px;height:"+u+"px;display:block;"),o.setAttribute("src",a),o.setAttribute("sandbox","allow-scripts allow-same-origin"),o.setAttribute("allowtransparency","true"),o.onload=function(){U.configureFrame(o,i)},l.parentNode.replaceChild(o,l),o}return null}}]),e}(),x=function(){function e(){var t=this;n(this,e),this._inlineFrames=[],this._onReadyFuncs=[],this._loadedInlineFrames=0,U.registerEvent("ready",function(){t._loadedInlineFrames++,t._loadedInlineFrames===t._inlineFrames.length&&t._onReadyFuncs.forEach(function(e){return e.call(t)})})}return t(e,[{key:"registerOnReady",value:function(e){this._onReadyFuncs.push(e)}},{key:"watch",value:function(e){null!==e&&this._inlineFrames.push(e)}}]),e}();return new(function(){function A(){n(this,A),this.handleError=function(e,t){I.isFunction(e)&&e({message:t})}}return t(A,[{key:"init",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.apiKey,r=e.url,i=e.onBlur,a=void 0===i?null:i,o=e.onFocus,l=void 0===o?null:o,s=e.style,u=void 0===s?null:s,c=e.cssUrl,d=void 0===c?null:c,f=e.placeholders,h=void 0===f?null:f,p=e.onSuccess,m=void 0===p?null:p,v=e.onError,y=void 0===v?null:v,g=e.onValidated,b=void 0===g?null:g,F="fields-holder-name",w="fields-card-number",k="fields-expiration",E="fields-cvc";if(!n)throw"Parameter `apiKey` is mandatory";if(!r)throw"Parameter `url` is mandatory";S.ensurePlaceholderFieldsAreSupported([F,w,k,E]),S.ensurePlaceholderFieldsExist([w,k,E]);var _=this;this._baseUrl=r,this._options={style:u||null,cssUrl:d||null,placeholders:h||{holdername:null,cardnumber:null,expiration:null,cvc:null}},U.init(r),U.registerEvent("blur",function(e){I.isFunction(a)&&a(e)}),U.registerEvent("validated",function(e){I.isFunction(b)&&b(e)}),U.registerEvent("focus",function(e){I.isFunction(l)&&l(e)}),this.inlineFrameWatcher=new x,this.inlineFrameWatcher.registerOnReady(function(){I.isFunction(m)&&m()}),I.postJson({url:I.buildApiUrl(r,"Initialize"),data:null,headers:{"Saferpay-LibVersion":A.version,"Saferpay-AuthToken":n,"Saferpay-Url":window.location.href},success:function(e){t._token=e.token,t.inlineFrameWatcher.watch(S.appendControllerIframe(_._baseUrl,_._token)),t.inlineFrameWatcher.watch(S.replaceElementWithHostedFieldsIframe(F,_._baseUrl,_._token,"holdername",t._options)),t.inlineFrameWatcher.watch(S.replaceElementWithHostedFieldsIframe(w,_._baseUrl,_._token,"cardnumber",t._options)),t.inlineFrameWatcher.watch(S.replaceElementWithHostedFieldsIframe(k,_._baseUrl,_._token,"expiration",t._options)),t.inlineFrameWatcher.watch(S.replaceElementWithHostedFieldsIframe(E,_._baseUrl,_._token,"cvc",t._options))},error:function(e){t.handleError(y,"".concat(e.title,". ").concat(e.detail||"").trim())}})}},{key:"submit",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.onSuccess,r=e.onError;if(!I.isFunction(n))throw"Parameter `onSuccess` is mandatory and has to be a callback function";U.registerEvent("submit",function(e){e.success?n({token:e.token}):t.handleError(r,"Submit failed for token ".concat(e.token,". ").concat(e.message,"."))}),U.submitData()}},{key:"version",get:function(){return"1.0.0"}}]),A}())}();